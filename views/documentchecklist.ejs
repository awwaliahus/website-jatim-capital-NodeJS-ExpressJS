<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Document Checklist</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Font & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background-color: #ffffff;
            color: #333;
        }

        .wrapper {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* ===== HEADER ===== */
        header {
            background: #ffffff;
            padding: 12px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #e5e7eb;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo img {
            margin-top: 5px;
            height: 70px;
            object-fit: contain;
        }

        /* ===== MAIN NAVIGATION ===== */
        .main-nav ul {
            list-style: none;
            display: flex;
            gap: 26px;
            margin: 0;
            padding: 0;
            margin-left: 680px;
        }

        .main-nav ul li a {
            text-decoration: none;
            color: #111827;
            font-weight: 500;
            font-size: 14px;
            padding: 8px 14px;
            border-radius: 6px;
            transition: 0.3s ease;
            font-family: 'Poppins', sans-serif;
        }

        .main-nav ul li a:hover {
            color: #fff;
            background: #111827;
        }

        .main-nav ul li a.active {
            background: #111827;
            color: #fff;
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 900px) {
            header {
                flex-wrap: wrap;
                justify-content: center;
            }

            .main-nav {
                width: 100%;
                text-align: center;
                margin-top: 10px;
            }

            .main-nav ul {
                justify-content: center;
                flex-wrap: wrap;
            }
        }

        .user-circle {
            width: 32px;
            height: 32px;
            background-color: #9ca3af;
            color: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
        }

        .user-dropdown {
            position: relative;
            display: inline-block;
        }

        .user-menu {
            position: absolute;
            top: 40px;
            right: 0;
            background-color: white;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            padding: 8px 0;
            min-width: 150px;
            z-index: 10;
        }

        .user-menu a {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            color: #333;
            text-decoration: none;
            font-size: 14px;
        }

        .user-menu a:hover {
            background-color: #f3f4f6;
        }

        .user-menu a.delete-account {
            color: #dc3545;
            font-weight: 500;
        }

        /* ===== MAIN ===== */
        .main {
            flex: 1;
            display: flex;
            background: #ffffff;
        }

        /* ===== SIDEBAR ===== */
        .sidebar {
            width: 250px;
            background: #f9fafb;
            padding: 24px;
            display: flex;
            flex-direction: column;
            align-items: center;
            border-radius: 16px;
            margin: 24px;

            /* ðŸ”§ Atur tinggi sidebar */
            height: 455px;
            overflow-y: auto;
            /* biar kalau kontennya lebih panjang, bisa discroll */
        }

        .sidebar .name {
            margin-top: 6px;
            font-size: 16px;
            font-weight: 600;
        }

        .sidebar .nav {
            margin-top: 24px;
            width: 100%;
        }

        .sidebar .nav-item {
            padding: 12px 0;
            border-bottom: 1px solid #e5e7eb;
            font-size: 11px !important;
            text-align: left;
            width: 100%;
            padding-left: 8px;
            cursor: pointer;
            line-height: 1.3;
            background: none;
        }

        #marketingToggle span {
            font-size: 11px !important;
            line-height: 1.3;
        }

        .sidebar form {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .sidebar form label img {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            aspect-ratio: 1 / 1;
            border: 2px solid #e5e7eb;
            display: block;
        }

        .hidden {
            display: none;
        }

        .content {
            flex: 1;
            padding: 40px;
        }

        /* ===== TITLE ===== */
        .page-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 18px;
            font-weight: 600;
            color: #0a0b0b;
            margin-bottom: 24px;
        }

        .page-title i {
            color: #9ca3af;
            font-size: 15px;
        }

        /* ===== FORM & TABLE ===== */
        .form-table-container {
            display: flex;
            gap: 40px;
            align-items: flex-start;
        }

        form#businessForm {
            width: 100%;
            max-width: 380px;
            background: #f9fafb;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.08);
        }

        label {
            font-size: 14px;
            margin-bottom: 5px;
            display: block;
            font-weight: 500;
        }

        select,
        input[type="text"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            margin-bottom: 15px;
            font-size: 14px;
        }

        #tableSection {
            flex: 1;
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 10px;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
            padding: 20px;
        }

        #tableSectionPerorangan {
            flex: 1;
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 10px;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
            padding: 20px;
            margin-top: 92px;
            margin-bottom: 40px;
            margin-right: 40px;
            height: auto;
            width: auto;
            min-width: 722px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 10px;
            border: 1px solid #e5e7eb;
            text-align: left;
            font-size: 14px;
        }

        th {
            background-color: #f9fafb;
            font-weight: 600;
            text-align: center;
        }

        td input[type="radio"] {
            display: block;
            margin: 0 auto;
            align-items: center;
        }

        /* ===== BUTTONS ===== */
        .button-container {
            text-align: right;
            margin-top: 20px;
        }

        .btn {
            background-color: #111827;
            color: #fff;
            border: none;
            border-radius: 6px;
            padding: 10px 20px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .btn:hover {
            background-color: #9297a4;
        }

        /* ===== FOOTER ===== */
        footer {
            background: #1f2937;
            color: #fff;
            text-align: left;
            padding: 32px 24px;
            font-size: 13px;
            min-height: 80px;
        }

        /* ===== STATUS ICON ANIMATION ===== */
        .status-result {
            display: flex;
            flex-direction: column;
            align-items: center;
            animation: fadeIn 0.5s ease-in-out;
        }

        .status-result i {
            font-size: 36px;
            margin-bottom: 5px;
        }

        .status-result span {
            font-weight: 600;
            font-size: 14px;
        }

        .status-result.success i {
            color: #16a34a;
            animation: scaleUp 0.4s ease;
        }

        .status-result.success span {
            color: #16a34a;
        }

        .status-result.failed i {
            color: #dc2626;
            animation: scaleUp 0.4s ease;
        }

        .status-result.failed span {
            color: #dc2626;
        }

        .status-result.pending i {
            color: #eab308;
            animation: pulse 1.5s infinite;
        }

        .status-result.pending span {
            color: #eab308;
        }

        /* ANIMASI */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes scaleUp {
            from {
                transform: scale(0.7);
            }

            to {
                transform: scale(1);
            }
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
                opacity: 1;
            }

            50% {
                transform: scale(1.1);
                opacity: 0.7;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
    </style>
</head>

<body>
    <div class="wrapper">
        <!-- ===== HEADER ===== -->
        <header>
            <div class="logo">
                <img src="/img/koperasi-jatim-capital-logo.png" alt="Logo Koperasi Berkembang Bersama Kami">
            </div>
            <nav class="main-nav">
                <ul>
                    <li><a href="/home">Home</a></li>
                    <li><a href="/dashboard">Dashboard</a></li>
                    <li><a href="/login">Log In</a></li>
                    <li><a href="/signup">Sign Up</a></li>
                </ul>
            </nav>

            <div class="user-dropdown">
                <div class="user-circle" id="userMenuToggle">
                    <%= user.first_name.charAt(0).toUpperCase() %>
                </div>
                <div class="user-menu hidden" id="userMenu">
                    <a href="/logout"><i class="fa-solid fa-right-from-bracket" style="color:#dc3545;"></i> Logout</a>
                    <form action="/delete-account" method="POST"
                        onsubmit="return confirm('Apakah Anda yakin ingin menghapus akun Anda?')" style="margin: 0;">
                        <button type="submit" class="delete-account"
                            style="background: none; border: none; width: 100%; text-align: left; padding: 8px 16px; color: #dc3545; font-weight: 500; display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <i class="fa-solid fa-trash"></i> Delete Account
                        </button>
                    </form>
                </div>
            </div>
        </header>

        <!-- ===== MAIN CONTENT ===== -->
        <div class="main">
            <!-- SIDEBAR -->
            <aside class="sidebar">
                <form action="/upload-profile" method="POST" enctype="multipart/form-data">
                    <% const profileImage=user.profile_picture && user.profile_picture.trim() !=='' ?
                        user.profile_picture : '/img/profile.png' ; %>
                        <label for="profileUpload">
                            <img src="<%= profileImage %>" alt="Profile" onerror="this.src='/img/profile.png';" />
                        </label>
                        <input id="profileUpload" type="file" name="profile_picture" style="display: none;"
                            onchange="this.form.submit()" />
                </form>

                <div class="name">
                    <%= user.first_name %>
                        <%= user.last_name %>
                </div>

                <div class="nav">
                    <div class="nav-item" id="goMain">Dashboard</div>
                    <div class="nav-item">Notes</div>
                </div>
            </aside>

            <!-- CONTENT -->
            <div class="content">
                <div class="page-title">
                    <i class="fa-solid fa-house"></i>
                    <span>Document Checklist</span>
                </div>

                <div class="form-table-container">
                    <!-- FORM -->
                    <form id="businessForm" method="POST" action="/document-checklist">
                        <label for="jenisPemohon">Jenis Pemohon:</label>
                        <select id="jenisPemohon" name="jenis_pemohon" required>
                            <option value="">-- Pilih Jenis Pemohon --</option>
                            <option value="perusahaan">Perusahaan</option>
                            <option value="perorangan">Perorangan</option>
                        </select>

                        <div id="formPerusahaan" class="hidden">
                            <label for="nama">Nama:</label>
                            <input type="text" id="nama" name="nama" placeholder="Masukkan nama anda" />

                            <label for="nama_perusahaan">Nama Perusahaan:</label>
                            <input type="text" id="namaPerusahaan" name="nama_perusahaan"
                                placeholder="Masukkan nama perusahaan" />

                            <label for="bidang_usaha">Bidang Usaha:</label>
                            <input type="text" id="bidangUsaha" name="bidang_usaha"
                                placeholder="Masukkan bidang usaha" />
                        </div>

                        <div id="formPerorangan" class="hidden">
                            <label for="nama2">Nama:</label>
                            <input type="text" id="nama2" name="nama" placeholder="Masukkan nama anda" />

                            <label for="namaPerusahaan2">Nama Perusahaan:</label>
                            <input type="text" id="namaPerusahaan2" name="nama_perusahaan"
                                placeholder="Masukkan nama perusahaan" />

                            <label for="bidangUsaha2">Bidang Usaha:</label>
                            <input type="text" id="bidangUsaha2" name="bidang_usaha"
                                placeholder="Masukkan bidang usaha" />
                        </div>
                    </form>

                    <!-- TABLE -->
                    <div id="tableSection" class="hidden">
                        <table>
                            <thead>
                                <tr>
                                    <th>No.</th>
                                    <th>Dokumen</th>
                                    <th>Ada</th>
                                    <th>Tidak Ada</th>
                                    <th>Keterangan</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- LEGALITAS USAHA -->
                                <tr>
                                    <td></td>
                                    <td style="font-weight: bold;">LEGALITAS USAHA</td>
                                    <td></td>
                                    <td></td>
                                    <!-- Merge kolom keterangan 8 baris -->
                                    <td rowspan="20"></td>
                                </tr>
                                <tr>
                                    <td>1</td>
                                    <label>
                                        <td>AKTA PENDIRIAN PT/CV</td>
                                    </label>
                                    <input type="hidden" name="akte_pendirian_ptcv" value="-1">
                                    <td><input type="radio" name="akte_pendirian_ptcv" value="1" /></td>
                                    <td><input type="radio" name="akte_pendirian_ptcv" value="0" /></td>
                                </tr>
                                <tr>
                                    <td>2</td>
                                    <label>
                                        <td>AKTA PERUBAHAN PT/CV</td>
                                    </label>
                                    <input type="hidden" name="akta_perubahan_ptcv" value="-1">
                                    <td><input type="radio" name="akta_perubahan_ptcv" value="1" /></td>
                                    <td><input type="radio" name="akta_perubahan_ptcv" value="0" /></td>
                                </tr>
                                <tr>
                                    <td>3</td>
                                    <label>
                                        <td>NPWP PT/CV</td>
                                    </label>
                                    <input type="hidden" name="npwp_ptcv" value="-1">
                                    <td><input type="radio" name="npwp_ptcv" value="1" /></td>
                                    <td><input type="radio" name="npwp_ptcv" value="0" /></td>
                                </tr>
                                <tr>
                                    <td>4</td>
                                    <label>
                                        <td>SK MENKUMHAM PT/CV</td>
                                    </label>
                                    <input type="hidden" name="sk_menkumham_ptcv" value="-1">
                                    <td><input type="radio" name="sk_menkumham_ptcv" value="1" /></td>
                                    <td><input type="radio" name="sk_menkumham_ptcv" value="0" /></td>
                                </tr>
                                <tr>
                                    <td>5</td>
                                    <label>
                                        <td>SIUP/NIB</td>
                                    </label>
                                    <input type="hidden" name="siup_nib" value="-1">
                                    <td><input type="radio" name="siup_nib" value="1" /></td>
                                    <td><input type="radio" name="siup_nib" value="0" /></td>
                                </tr>
                                <tr>
                                    <td>6</td>
                                    <label>
                                        <td>TDP</td>
                                    </label>
                                    <input type="hidden" name="tdp" value="-1">
                                    <td><input type="radio" name="tdp" value="1" /></td>
                                    <td><input type="radio" name="tdp" value="0" /></td>
                                </tr>
                                <tr>
                                    <td>7</td>
                                    <label>
                                        <td>KTP SELURUH PENGURUS PT/CV</td>
                                    </label>
                                    <input type="hidden" name="ktp_pengurus_ptcv" value="-1">
                                    <td><input type="radio" name="ktp_pengurus_ptcv" value="1" /></td>
                                    <td><input type="radio" name="ktp_pengurus_ptcv" value="0" /></td>
                                </tr>
                                <tr>
                                    <td>8</td>
                                    <label>
                                        <td>NPWP PENGURUS PT/CV</td>
                                    </label>
                                    <input type="hidden" name="npwp_pengurus_ptcv" value="-1">
                                    <td><input type="radio" name="npwp_pengurus_ptcv" value="1" /></td>
                                    <td><input type="radio" name="npwp_pengurus_ptcv" value="0" /></td>
                                </tr>

                                <!-- KEUANGAN -->
                                <tr>
                                    <td></td>
                                    <td style="font-weight: bold;">KEUANGAN</td>
                                    <td></td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td>1</td>
                                    <label>
                                        <td>LAPORAN KEUANGAN / REK KORAN</td>
                                    </label>
                                    <input type="hidden" name="laporan_keuangan" value="-1">
                                    <td><input type="radio" name="laporan_keuangan" value="1" /></td>
                                    <td><input type="radio" name="laporan_keuangan" value="0" /></td>
                                </tr>
                                <tr>
                                    <td>2</td>
                                    <label>
                                        <td>INVOICE PELANGGAN / KONTRAK KERJA</td>
                                    </label>
                                    <input type="hidden" name="invoice_pelanggan_kontrak_kerja" value="-1">
                                    <td><input type="radio" name="invoice_pelanggan_kontrak_kerja" value="1" /></td>
                                    <td><input type="radio" name="invoice_pelanggan_kontrak_kerja" value="0" /></td>
                                </tr>

                                <!-- JAMINAN -->
                                <tr>
                                    <td></td>
                                    <td style="font-weight: bold;">JAMINAN</td>
                                    <td></td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td>1</td>
                                    <label>
                                        <td>SERTIFIKAT (SHM ATAU SHGB)</td>
                                    </label>
                                    <input type="hidden" name="sertifikat_shm_shgb" value="-1">
                                    <td><input type="radio" name="sertifikat_shm_shgb" value="1" /></td>
                                    <td><input type="radio" name="sertifikat_shm_shgb" value="0" /></td>
                                </tr>
                                <tr>
                                    <td>2</td>
                                    <label>
                                        <td>IMB</td>
                                    </label>
                                    <input type="hidden" name="imb" value="-1">
                                    <td><input type="radio" name="imb" value="1" /></td>
                                    <td><input type="radio" name="imb" value="0" /></td>
                                </tr>
                                <tr>
                                    <td>3</td>
                                    <label>
                                        <td>PBB TAHUN TERAKHIR</td>
                                    </label>
                                    <input type="hidden" name="pbb_terakhir" value="-1">
                                    <td><input type="radio" name="pbb_terakhir" value="1" /></td>
                                    <td><input type="radio" name="pbb_terakhir" value="0" /></td>
                                </tr>

                                <!-- LAIN-LAIN -->
                                <tr>
                                    <td></td>
                                    <td style="font-weight: bold;">LAIN-LAIN</td>
                                    <td></td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td>1</td>
                                    <label>
                                        <td>SUMMARY KREDIT</td>
                                    </label>
                                    <input type="hidden" name="summary_kredit" value="-1">
                                    <td><input type="radio" name="summary_kredit" value="1" /></td>
                                    <td><input type="radio" name="summary_kredit" value="0" /></td>
                                </tr>
                                <tr>
                                    <td>2</td>
                                    <label>
                                        <td>HASIL RESUME PENILAIAN JAMINAN (KJPP)</td>
                                    </label>
                                    <input type="hidden" name="hasil_resume_penilaian_kjpp" value="-1">
                                    <td><input type="radio" name="hasil_resume_penilaian_kjpp" value="1" /></td>
                                    <td><input type="radio" name="hasil_resume_penilaian_kjpp" value="0" /></td>
                                </tr>
                                <tr>
                                    <td>3</td>
                                    <label>
                                        <td>BUKU APPRAISAL</td>
                                    </label>
                                    <input type="hidden" name="buku_appraisal" value="-1">
                                    <td><input type="radio" name="buku_appraisal" value="1" /></td>
                                    <td><input type="radio" name="buku_appraisal" value="0" /></td>
                                </tr>
                            </tbody>
                        </table>
                        <div class="button-container">
                            <button id="addNew" class="btn">Add New</button>
                            <button id="saveChecklist" class="btn">Save Data</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TABLE PERORANGAN -->
            <div id="tableSectionPerorangan" class="hidden">
                <table>
                    <thead>
                        <tr>
                            <th>No.</th>
                            <th>Dokumen</th>
                            <th>Ada</th>
                            <th>Tidak Ada</th>
                            <th>Keterangan</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- LEGALITAS USAHA -->
                        <tr>
                            <td></td>
                            <td style="font-weight: bold;">LEGALITAS USAHA</td>
                            <td></td>
                            <td></td>
                            <!-- Merge kolom keterangan 8 baris -->
                            <td rowspan="20"></td>
                        </tr>
                        <tr>
                            <td>1</td>
                            <label>
                                <td>KTP SUAMI/ ISTRI</td>
                            </label>
                            <input type="hidden" name="ktp_suami_istri" value="-1">
                            <td><input type="radio" name="ktp_suami_istri" value="1" /></td>
                            <td><input type="radio" name="ktp_suami_istri" value="0" /></td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <label>
                                <td>NPWP</td>
                            </label>
                            <input type="hidden" name="npwp_pribadi" value="-1">
                            <td><input type="radio" name="npwp_pribadi" value="1" /></td>
                            <td><input type="radio" name="npwp_pribadi" value="0" /></td>
                        </tr>
                        <tr>
                            <td>3</td>
                            <label>
                                <td>KARTU KELUARGA</td>
                            </label>
                            <input type="hidden" name="kartu_keluarga" value="-1">
                            <td><input type="radio" name="kartu_keluarga" value="1" /></td>
                            <td><input type="radio" name="kartu_keluarga" value="0" /></td>
                        </tr>
                        <tr>
                            <td>4</td>
                            <label>
                                <td>AKTA NIKAH</td>
                            </label>
                            <input type="hidden" name="akta_nikah" value="-1">
                            <td><input type="radio" name="akta_nikah" value="1" /></td>
                            <td><input type="radio" name="akta_nikah" value="0" /></td>
                        </tr>
                        <tr>
                            <td>5</td>
                            <label>
                                <td>SIUP/ NIB</td>
                            </label>
                            <input type="hidden" name="siup_nib" value="-1">
                            <td><input type="radio" name="siup_nib" value="1" /></td>
                            <td><input type="radio" name="siup_nib" value="0" /></td>
                        </tr>
                        <tr>
                            <td>6</td>
                            <label>
                                <td>TDP</td>
                            </label>
                            <input type="hidden" name="tdp" value="-1">
                            <td><input type="radio" name="tdp" value="1" /></td>
                            <td><input type="radio" name="tdp" value="0" /></td>
                        </tr>

                        <!-- KEUANGAN -->
                        <tr>
                            <td></td>
                            <td style="font-weight: bold;">KEUANGAN</td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>1</td>
                            <label>
                                <td>LAPORAN KEUANGAN / REK KORAN</td>
                            </label>
                            <input type="hidden" name="laporan_keuangan" value="-1">
                            <td><input type="radio" name="laporan_keuangan" value="1" /></td>
                            <td><input type="radio" name="laporan_keuangan" value="0" /></td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <label>
                                <td>INVOICE PELANGGAN / KONTRAK KERJA</td>
                            </label>
                            <input type="hidden" name="invoice_pelanggan_kontrak_kerja" value="-1">
                            <td><input type="radio" name="invoice_pelanggan_kontrak_kerja" value="1" /></td>
                            <td><input type="radio" name="invoice_pelanggan_kontrak_kerja" value="0" /></td>
                        </tr>

                        <!-- JAMINAN -->
                        <tr>
                            <td></td>
                            <td style="font-weight: bold;">JAMINAN</td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>1</td>
                            <label>
                                <td>SERTIFIKAT (SHM ATAU SHGB)</td>
                            </label>
                            <input type="hidden" name="sertifikat_shm_shgb" value="-1">
                            <td><input type="radio" name="sertifikat_shm_shgb" value="1" /></td>
                            <td><input type="radio" name="sertifikat_shm_shgb" value="0" /></td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <label>
                                <td>IMB</td>
                            </label>
                            <input type="hidden" name="imb" value="-1">
                            <td><input type="radio" name="imb" value="1" /></td>
                            <td><input type="radio" name="imb" value="0" /></td>
                        </tr>
                        <tr>
                            <td>3</td>
                            <label>
                                <td>PBB TAHUN TERAKHIR</td>
                            </label>
                            <input type="hidden" name="pbb_terakhir" value="-1">
                            <td><input type="radio" name="pbb_terakhir" value="1" /></td>
                            <td><input type="radio" name="pbb_terakhir" value="0" /></td>
                        </tr>

                        <!-- LAIN-LAIN -->
                        <tr>
                            <td></td>
                            <td style="font-weight: bold;">LAIN-LAIN</td>
                            <td></td>
                            <td></td>

                        </tr>
                        <tr>
                            <td>1</td>
                            <label>
                                <td>SUMMARY KREDIT</td>
                            </label>
                            <input type="hidden" name="summary_kredit" value="-1">
                            <td><input type="radio" name="summary_kredit" value="1" /></td>
                            <td><input type="radio" name="summary_kredit" value="0" /></td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <label>
                                <td>HASIL RESUME PENILAIAN JAMINAN (KJPP)</td>
                            </label>
                            <input type="hidden" name="hasil_resume_penilaian_kjpp" value="-1">
                            <td><input type="radio" name="hasil_resume_penilaian_kjpp" value="1" /></td>
                            <td><input type="radio" name="hasil_resume_penilaian_kjpp" value="0" /></td>
                        </tr>
                        <tr>
                            <td>3</td>
                            <label>
                                <td>BUKU APPRAISAL</td>
                            </label>
                            <input type="hidden" name="buku_appraisal" value="-1">
                            <td><input type="radio" name="buku_appraisal" value="1" /></td>
                            <td><input type="radio" name="buku_appraisal" value="0" /></td>
                        </tr>
                    </tbody>
                </table>
                <div class="button-container">
                    <button id="addNewPerorangan" class="btn">Add New</button>
                    <button id="saveChecklistPerorangan" class="btn">Save Data</button>
                </div>
            </div>
        </div>
        <footer>
            Â© Jatim Capital 2025
        </footer>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
        const toggle = document.getElementById("userMenuToggle");
        const menu = document.getElementById("userMenu");

        toggle.addEventListener("click", () => menu.classList.toggle("hidden"));
        document.addEventListener("click", (e) => {
          if (!toggle.contains(e.target) && !menu.contains(e.target)) {
            menu.classList.add("hidden");
          }
        });
            document.getElementById("goMain").addEventListener("click", function () {
                window.location.href = "/dashboard";
            });
            
            // ====== ELEMENTS ======
            const jenisPemohon = document.getElementById("jenisPemohon");
            const formPerusahaan = document.getElementById("formPerusahaan");
            const formPerorangan = document.getElementById("formPerorangan");
            const tableSection = document.getElementById("tableSection");
            const tableSectionPerorangan = document.getElementById("tableSectionPerorangan");

            const nama = document.getElementById("nama");
            const namaPerusahaan = document.getElementById("namaPerusahaan");
            const bidangUsaha = document.getElementById("bidangUsaha");

            const nama2 = document.getElementById("nama2");
            const namaPerusahaan2 = document.getElementById("namaPerusahaan2");
            const bidangUsaha2 = document.getElementById("bidangUsaha2");

            const addNewBtn = document.getElementById("addNew");
            const addNewBtnPerorangan = document.getElementById("addNewPerorangan");
            const saveBtn = document.getElementById("saveChecklist");
            const saveBtnPerorangan = document.getElementById("saveChecklistPerorangan");

            // ====== TABLE/STATUS ELEMENTS ======
            const tablePerusahaan = document.querySelector("#tableSection table");
            const tablePerorangan = document.querySelector("#tableSectionPerorangan table");
            const statusCellPerusahaan = tablePerusahaan ? tablePerusahaan.querySelector("td[rowspan]") : null;
            const statusCellPerorangan = tablePerorangan ? tablePerorangan.querySelector("td[rowspan]") : null;

            // ====== HELPERS ======
            const radiosPerusahaan = () => tablePerusahaan ? tablePerusahaan.querySelectorAll("input[type='radio']") : [];
            const radiosPerorangan = () => tablePerorangan ? tablePerorangan.querySelectorAll("input[type='radio']") : [];

            function setActiveSection(section) {
                // section: 'perusahaan' | 'perorangan' | null
                const enable = (nodeList) => nodeList.forEach(r => r.disabled = false);
                const disable = (nodeList) => nodeList.forEach(r => r.disabled = true);

                if (section === 'perusahaan') {
                    enable(radiosPerusahaan());
                    disable(radiosPerorangan());
                } else if (section === 'perorangan') {
                    enable(radiosPerorangan());
                    disable(radiosPerusahaan());
                } else {
                    disable(radiosPerusahaan());
                    disable(radiosPerorangan());
                }
            }

            function enableRadioUncheck(container) {
                if (!container) return;
                // Simpan status sebelum klik
                container.addEventListener("pointerdown", function (e) {
                    const r = e.target;
                    if (r && r.tagName === "INPUT" && r.type === "radio" && !r.disabled) {
                        r.dataset.downChecked = r.checked ? "1" : "0";
                    }
                });

                // Klik ulang => uncheck
                container.addEventListener("click", function (e) {
                    const r = e.target;
                    if (r && r.tagName === "INPUT" && r.type === "radio" && !r.disabled) {
                        if (r.dataset.downChecked === "1") {
                            r.checked = false;
                            r.dispatchEvent(new Event("change", { bubbles: true }));
                        }
                    }
                });
            }

            function updateStatus(tableEl, statusCellEl) {
                if (!tableEl || !statusCellEl) return;

                // Ambil semua baris yang punya radio
                const rows = [...tableEl.querySelectorAll("tbody tr")].filter(r => r.querySelector('input[type="radio"]'));
                const totalRows = rows.length;

                let adaChecked = 0;
                let tidakAdaChecked = 0;
                let totalCeklis = 0;

                rows.forEach(row => {
                    const radios = row.querySelectorAll('input[type="radio"]');
                    if (radios.length >= 2) {
                        const [ada, tidakAda] = radios;
                        if (ada && ada.checked) adaChecked++;
                        if (tidakAda && tidakAda.checked) tidakAdaChecked++;
                        if ((ada && ada.checked) || (tidakAda && tidakAda.checked)) totalCeklis++;
                    }
                });

                let html = "";
                if (adaChecked === 0 && tidakAdaChecked === 0) {
                    html = `
        <div class="status-result pending">
          <i class="fa-solid fa-hourglass-half"></i>
          <span>PENDING</span>
        </div>`;
                } else if (adaChecked === totalRows) {
                    html = `
        <div class="status-result success">
          <i class="fa-solid fa-circle-check"></i>
          <span>LENGKAP</span>
        </div>`;
                } else if (tidakAdaChecked === totalRows) {
                    html = `
        <div class="status-result failed">
          <i class="fa-solid fa-circle-xmark"></i>
          <span>TIDAK LENGKAP</span>
        </div>`;
                } else if (totalCeklis === totalRows && adaChecked > 0 && tidakAdaChecked > 0) {
                    html = `
        <div class="status-result failed">
          <i class="fa-solid fa-circle-xmark"></i>
          <span>TIDAK LENGKAP</span>
        </div>`;
                } else {
                    html = `
        <div class="status-result pending">
          <i class="fa-solid fa-hourglass-half"></i>
          <span>PENDING</span>
        </div>`;
                }

                statusCellEl.innerHTML = html;
            }

            function resetStatus(statusCellEl) {
                if (!statusCellEl) return;
                statusCellEl.innerHTML = `
      <div class="status-result pending">
        <i class="fa-solid fa-hourglass-half"></i>
        <span>PENDING</span>
      </div>`;
            }

            function clearRadios(nodeList) {
                nodeList.forEach(r => {
                    r.checked = false;
                    r.dataset.downChecked = "0";
                });
            }

            function checkFormCompletion() {
                if (
                    jenisPemohon.value === "perusahaan" &&
                    nama.value.trim() !== "" &&
                    namaPerusahaan.value.trim() !== "" &&
                    bidangUsaha.value.trim() !== ""
                ) {
                    tableSection.classList.remove("hidden");
                    setActiveSection('perusahaan');
                } else {
                    tableSection.classList.add("hidden");
                    setActiveSection(null);
                }
            }

            function checkFormCompletionPerorangan() {
                if (
                    jenisPemohon.value === "perorangan" &&
                    nama2.value.trim() !== "" &&
                    namaPerusahaan2.value.trim() !== "" &&
                    bidangUsaha2.value.trim() !== ""
                ) {
                    tableSectionPerorangan.classList.remove("hidden");
                    setActiveSection('perorangan');
                } else {
                    tableSectionPerorangan.classList.add("hidden");
                    setActiveSection(null);
                }
            }

            // Kumpulkan semua radio (nama grup) dan hasilnya (1 / 0 / -1)
            function collectRadioValues(container) {
                const out = {};
                if (!container) return out;

                // Dapatkan semua nama grup unik
                const allRadios = container.querySelectorAll('input[type="radio"]');
                allRadios.forEach(r => out[r.name] = -1); // default -1

                // Override dengan nilai yang dipilih
                const checked = container.querySelectorAll('input[type="radio"]:checked');
                checked.forEach(r => {
                    const v = parseInt(r.value, 10);
                    out[r.name] = (v === 1 || v === 0) ? v : -1;
                });

                return out;
            }

            // ====== INIT ======
            // Toggle Laporan
            if (laporanToggle && laporanMenu && arrow) {
                laporanToggle.addEventListener("click", () => {
                    laporanMenu.classList.toggle("hidden");
                    arrow.innerHTML = laporanMenu.classList.contains("hidden") ? "&#9662;" : "&#9652;";
                });
            }

            // Nav
            if (goDashboard) goDashboard.addEventListener("click", () => (window.location.href = "/dashboard"));
            if (goChecklist) goChecklist.addEventListener("click", () => (window.location.href = "/document-checklist"));
            if (goUpload) goUpload.addEventListener("click", () => (window.location.href = "/document-upload"));
            if (goLog) goLog.addEventListener("click", () => (window.location.href = "/log-data"));

            // Section aktif awal (keduanya hidden)
            setActiveSection(null);

            // Radio uncheck on second click
            enableRadioUncheck(tableSection);
            enableRadioUncheck(tableSectionPerorangan);

            // Status awal
            updateStatus(tablePerusahaan, statusCellPerusahaan);
            updateStatus(tablePerorangan, statusCellPerorangan);

            // Perubahan radio => update status (kedua tabel)
            radiosPerusahaan().forEach(r => r.addEventListener("change", () => updateStatus(tablePerusahaan, statusCellPerusahaan)));
            radiosPerorangan().forEach(r => r.addEventListener("change", () => updateStatus(tablePerorangan, statusCellPerorangan)));

            // Input form -> validasi tampilkan tabel
            [nama, namaPerusahaan, bidangUsaha, jenisPemohon].forEach(el => {
                if (!el) return;
                el.addEventListener("input", checkFormCompletion);
                el.addEventListener("change", checkFormCompletion);
            });
            [nama2, namaPerusahaan2, bidangUsaha2, jenisPemohon].forEach(el => {
                if (!el) return;
                el.addEventListener("input", checkFormCompletionPerorangan);
                el.addEventListener("change", checkFormCompletionPerorangan);
            });

            // Ganti jenis pemohon (tampilkan/hide form & tabel)
            jenisPemohon.addEventListener("change", function () {
                if (this.value === "perusahaan") {
                    formPerusahaan.classList.remove("hidden");
                    formPerorangan.classList.add("hidden");
                    checkFormCompletion();
                    tableSectionPerorangan.classList.add("hidden");
                    setActiveSection('perusahaan');
                } else if (this.value === "perorangan") {
                    formPerorangan.classList.remove("hidden");
                    formPerusahaan.classList.add("hidden");
                    checkFormCompletionPerorangan();
                    tableSection.classList.add("hidden");
                    setActiveSection('perorangan');
                } else {
                    formPerusahaan.classList.add("hidden");
                    formPerorangan.classList.add("hidden");
                    tableSection.classList.add("hidden");
                    tableSectionPerorangan.classList.add("hidden");
                    setActiveSection(null);
                }
            });

            // ====== RESET (Perusahaan) ======
            if (addNewBtn) addNewBtn.addEventListener("click", function (e) {
                e.preventDefault();
                document.getElementById("businessForm").reset();
                jenisPemohon.value = "";
                formPerusahaan.classList.add("hidden");
                formPerorangan.classList.add("hidden");
                clearRadios(radiosPerusahaan());
                resetStatus(statusCellPerusahaan);
                tableSection.classList.add("hidden");
                setActiveSection(null);
            });

            // ====== RESET (Perorangan) ======
            if (addNewBtnPerorangan) addNewBtnPerorangan.addEventListener("click", function (e) {
                e.preventDefault();
                document.getElementById("businessForm").reset();
                jenisPemohon.value = "";
                formPerorangan.classList.add("hidden");
                formPerusahaan.classList.add("hidden");
                clearRadios(radiosPerorangan());
                resetStatus(statusCellPerorangan);
                tableSectionPerorangan.classList.add("hidden");
                setActiveSection(null);
            });

            // ====== SAVE (Perusahaan) ======
            if (saveBtn) saveBtn.addEventListener("click", async function (e) {
                e.preventDefault();

                const jenis = jenisPemohon.value;
                const namaVal = (nama ? nama.value : "").trim();
                const namaPerusahaanVal = (namaPerusahaan ? namaPerusahaan.value : "").trim();
                const bidangUsahaVal = (bidangUsaha ? bidangUsaha.value : "").trim();
                const keterangan = (statusCellPerusahaan ? statusCellPerusahaan.textContent.trim() : "-");

                if (!jenis || !namaVal || !namaPerusahaanVal || !bidangUsahaVal) {
                    alert("Lengkapi form terlebih dahulu!");
                    return;
                }

                // radio values lengkap (1/0/-1)
                const radioData = collectRadioValues(tablePerusahaan);

                try {
                    const response = await fetch("/document-checklist", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            jenis_pemohon: jenis,
                            nama: namaVal,
                            nama_perusahaan: namaPerusahaanVal,
                            bidang_usaha: bidangUsahaVal,
                            keterangan: keterangan || "-",
                            ...radioData
                        }),
                    });

                    if (response.ok) {
                        alert("Data berhasil disimpan ke database!");
                        document.getElementById("businessForm").reset();
                        tableSection.classList.add("hidden");
                        clearRadios(radiosPerusahaan());
                        resetStatus(statusCellPerusahaan);
                        setActiveSection(null);
                    } else {
                        alert("Gagal menyimpan data.");
                    }
                } catch (error) {
                    console.error("Error saving checklist:", error);
                    alert("Terjadi kesalahan jaringan.");
                }
            });

            // ====== SAVE (Perorangan) ======
            if (saveBtnPerorangan) saveBtnPerorangan.addEventListener("click", async function (e) {
                e.preventDefault();

                const jenis = jenisPemohon.value;
                const namaVal = (nama2 ? nama2.value : "").trim();
                const namaPerusahaanVal = (namaPerusahaan2 ? namaPerusahaan2.value : "").trim();
                const bidangUsahaVal = (bidangUsaha2 ? bidangUsaha2.value : "").trim();
                const keterangan = (statusCellPerorangan ? statusCellPerorangan.textContent.trim() : "-");

                if (!jenis || !namaVal || !namaPerusahaanVal || !bidangUsahaVal) {
                    alert("Lengkapi form terlebih dahulu!");
                    return;
                }

                // radio values lengkap (1/0/-1)
                const radioData = collectRadioValues(tablePerorangan);

                try {
                    const response = await fetch("/document-checklist", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            jenis_pemohon: jenis,
                            nama: namaVal,
                            nama_perusahaan: namaPerusahaanVal,
                            bidang_usaha: bidangUsahaVal,
                            keterangan: keterangan || "-",
                            ...radioData
                        }),
                    });

                    if (response.ok) {
                        alert("Data berhasil disimpan ke database!");
                        document.getElementById("businessForm").reset();
                        tableSectionPerorangan.classList.add("hidden");
                        clearRadios(radiosPerorangan());
                        resetStatus(statusCellPerorangan);
                        setActiveSection(null);
                    } else {
                        alert("Gagal menyimpan data.");
                    }
                } catch (error) {
                    console.error("Error saving checklist:", error);
                    alert("Terjadi kesalahan jaringan.");
                }
            });

        });
    </script>
</body>

</html>